{% load static %}

{% load mathfilters %}

{% load use_dict %}

<div class="table-responsive-md">
    <table class="table table-hover table-bordered table-sm table-dark text-center">
        <!-- Table header -->
        <thead>
            <tr class="bg-secondary">
                <!-- col name -->
                <th scope="col" rowspan='2' style="vertical-align: middle;">Produit</th>
                <!---->
                <!-- col gain-->
                <th scope="col" rowspan='2' style="vertical-align: middle;">Gain</th>
                <!-- -->
                <!-- col cost-->
                <th scope="col" rowspan='2' style="vertical-align: middle;">Coût</th>
                <!-- -->
                <!-- 2 cols benefit -->
                <th colspan="2" style="vertical-align: middle;">Bénéfice</th>
                <!-- -->                
            </tr>
            <tr class="bg-secondary">
                <!-- col benefit -->
                <th scope="col">total</th>
                <th scope="col">% des bénéfices par produit</th>
                <!---->
            </tr>
        </thead>
        <!---->
        <!-- Table lines -->
        <tbody>
            {% for product in products %}
                {% with total_cost_by_product|get_value:product.id as cost %}
                <!-- line for each product -->
                <tr>
                    <!-- name -->
                    <td style="vertical-align: middle;">
                        {{ product.name }}
                    </td>
                    <!---->
                    <!-- gain -->
                    <td style="vertical-align: middle;">
                        {% for key, value in total_by_products.items %}
                            {% if key.name == product.name %}
                                {{ value.1 }}
                            {% endif %}
                        {% endfor %}
                    </td>
                    <!---->
                    <!-- cost -->
                    <td style="vertical-align: middle;">
                        {% if cost != 0 %}
                            {{ cost }}
                        {% endif %}
                    </td>
                    <!---->
                    <!-- benefit -->
                    <td style="vertical-align: middle;">
                        {% for key, value in total_by_products.items %}
                            {% if key.name == product.name %}
                                {{ value.1|sub:cost }}
                            {% endif %}
                        {% endfor %}
                    </td>
                    <!---->
                    <!-- benefit % -->
                    <td style="vertical-align: middle;">
                        {% for key, value in total_by_products.items %}
                            {% if key.name == product.name %}
                                {% with value.1|sub:cost as benefit %}
                                {% with total_revenue|sub:total_costs_product as total_benefit %}
                                {{ 100|mul:benefit|div:total_benefit|floatformat:"-2" }} %
                                {% endwith %}
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                    </td>
                    <!---->
                </tr>
                {% endwith %}
            {% endfor %}
        </tbody>
        <!---->
    </table>
</div>
